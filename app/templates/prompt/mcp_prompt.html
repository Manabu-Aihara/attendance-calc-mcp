<!DOCTYPE html>
<html lang="ja">

<head>
    <!-- <meta charset="UTF-8"> -->
    <!--
    Source - https://stackoverflow.com/a
    Posted by Ry-
    Retrieved 2026-01-27, License - CC BY-SA 4.0
    -->

    <meta http-equiv="Content-Type" content="text/event-stream" charset="utf-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://unpkg.com/htmx.org@2.0.8/dist/htmx.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // 追加されたメッセージを自動でMarkdownパースする
        document.body.addEventListener('htmx:afterSettle', function (evt) {
            const contents = evt.detail.elt.querySelectorAll('.markdown-content');
            contents.forEach(el => {
                if (!el.dataset.parsed) {
                    el.innerHTML = marked.parse(el.textContent);
                    el.dataset.parsed = "true";
                }
            });
        });
    </script>
    <title>Conversation page</title>
</head>
</head>

<body>
    <h1>Conversation page</h1>
    <h2>User attendance list</h2>
    {# 【Jinja】Includeブロック内で変数を展開する #}
    {# https://sagaziiin.hatenablog.com/entry/2023/02/28/215930 #}
    {% include "%s" % list_table %}
    <h2>MCP prompt for attendance</h2>
    <div id="chat-history" class="min-h-[15rem] p-4 border overflow-y-auto markdown-content">
    </div>

    <form hx-post="/analyze-attendance-prompt" hx-trigger="submit" hx-method="post" hx-target="#chat-history"
        hx-swap="beforeend" hx-on::after-request="this.reset()">
        <input type="hidden" name="staff_id" value="{{ staff_id }}">
        <input type="hidden" name="target_month" value="{{ target_month }}">
        <textarea name="user_input" class="w-full" placeholder="例：3日のマイナス理由を教えて"></textarea>
        <button type="submit">送信</button>
    </form>

</body>

</html>