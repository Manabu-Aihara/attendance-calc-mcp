# 勤怠データ照合結果における、差異の確認のためのMCP化

## 1. 概要

### 1.1 目的
出退勤管理システムを新しく導入するにあたり、既存システムと新システムの勤怠データの整合性を確認する必要があります。これにより、新システムへの移行がスムーズに行えるようになります。

### 1.2 ユーザーシナリオ
ユーザーは、既存システムと新システムの、一ヶ月間分を集計した勤怠データを比較し、差異を特定させたjsonファイルを事前に参照します。これより後、新システムの計算過程を検証するために、特定の社員IDと対象月に対して、勤怠データの計算過程をチャット形式で問い合わせることができるようにします。

## 2. 要件定義

### 2.1. 機能要件
- ユーザーが指定した"社員ID"、"対象月"に対して、問い合わせをチャット形式で受け付けるようにします。

#### 2.1.1. 基本機能
1. **一覧表示機能:** 特定した社員IDと対象月に対して、一日単位の計算過程(ロジック)を返します。
2. **イレギュラー調査:** 値がマイナスを返している場合など、イレギュラーな値に対して、原因を推論し、説明を返します。

### 2.2. 非機能要件
- **トークンの削減:** チャットによるトークン削減のため、"社員ID"と"対象月"をチャット内容に加えないようにし、あらかじめ指定して、必要なデータのみを返すようにします。

## 3. 実装詳細

### 3.1. テンプレートの用意
1. app/templates/ に、社員IDと対象月を指定した後、会話をの入出力を記録するプロンプトを備えたテンプレートファイルを用意します。

### 3.2. ツールの実装
1. MCPサーバーをセットアップします。FastMCPなどのフレームワークを使用します。
2. 既存の app/attendance_day_collect.py::collect_attendance_data ロジックを、MCP（Model Context Protocol）サーバーの「ツール」とします。
3. MCPサーバー上で動作するように、必要なラッパーコードを実装します。
4. MCPツールとして、ユーザーからの「一覧を出して」という命令に対して、指定された社員IDと対象月の勤怠データの計算過程を返すようにします。 

### 3.3. テストケースの追加
1. MCPツールとしての動作確認のため、テストケースを追加します。

## 4. タスク一覧
- [ ] MCPサーバーのセットアップ
- [ ] app/attendance_day_collect.py::collect_attendance_data をMCPツールとして登録できるようにする
- [ ] テストケースの追加（MCPツールとしての動作確認）
- [ ] 「一覧を出して」と命令したら、結果が返ってくることを確認する
- [ ] ドキュメントの整備（README.mdやMCPツールの説明など）

